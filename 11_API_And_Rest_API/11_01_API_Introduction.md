# Введение в API

## Аналогия с жизнью

Прежде чем рассмотреть, что такое API в программировании, давайте рассмотрим пример из реальной жизни.

Представьте, что вы пришли в ресторан. Вы открываете меню, выбираете блюдо – допустим, фуа-гра с трюфелями. Подходит официант, вы делаете заказ, и он уходит на кухню. Там повар готовит ваше блюдо и передает его обратно официанту, который приносит его к вашему столику. Ситуация обычная и понятная.

_А теперь задайтесь вопросом_: вы знаете, что именно происходит на кухне? Как повар готовит еду? Какие процессы и технологии он использует? Скорее всего — нет. Вы просто сделали заказ и получили результат. А повар знает, кто вы такой и зачем вам эта фуа-гра? Тоже нет. Он просто получил указание от официанта, и выполнил его.

Обратите внимание: **вы и повар фактически взаимодействовали не напрямую, а через посредника – официанта**. Вам, как клиенту, не нужно знать, что происходит на кухне и как именно повар готовит фуа-гру. Достаточно уметь правильно сделать заказ официанту. Со своей стороны, повар не обязан знать подробности о вас – ему достаточно получить от официанта понятный заказ и исполнить его. Вы получили результат (готовое блюдо), даже не заглядывая на кухню, а повар приготовил его, не общаясь с вами лично.

Эта простая аналогия хорошо иллюстрирует роль API. В нашем примере ресторанного сервиса официант выступает в роли посредника, который принимает запросы от клиента и возвращает результаты от исполнителя. Подобно этому, **API (Application Programming Interface)** – это интерфейс, посредник между двумя программами или компонентами, который принимает запросы и возвращает ответы. Например, посетитель ресторана (пользователь) делает заказ официанту (API), а кухня (сервер) его выполняет [^1]. Клиенту не нужно знать, как устроена кухня, а повару не важно, кто клиент – достаточно стандартизованного взаимодействия через “интерфейс” (официанта).

## Что такое API в программировании?

Аббревиатура **API** расшифровывается как _Application Programming Interface_, то есть «программный интерфейс приложения». Под API понимается набор правил и способов, с помощью которых одна программа может взаимодействовать с другой. Проще говоря, API скрывает внутреннюю реализацию одного компонента и предоставляет другим компонентам определенный набор функций или методов для общения [^1]. API выступает как контракт: если вы посылаете запрос определенного вида, то получите оговоренный ответ определенного формата.

В программировании API может принимать разные формы. Например:

- **API операционной системы**. Функции, через которые программы взаимодействуют с ОС (_например_, функции для работы с файлами, сетью и т.д.).
- **API библиотек и фреймворков**. Публичные методы/функции, которые предоставляет библиотека, чтобы разработчик мог выполнять определенные задачи, не вникая в реализацию.
- **Веб-API (Web API)**. Интерфейсы для взаимодействия между веб-сервисами (_о них далее_). Они позволяют приложениям обмениваться.

### Пример минималистичного API: обмен данными через файл

Рассмотрим наглядный, пусть и примитивный, пример реализации API во взаимодействии между двумя независимыми программами.

Представим, что есть два приложения:

- **Приложение A** — отвечает за создание пользователей. _Разработано на языке PHP_.
- **Приложение B** — занимается отправкой электронных писем созданным пользователям. _Реализовано на C++_.

Цель у них общая — работать с пользователями. Однако, так как они написаны на разных языках и, возможно, развиваются разными командами, они не могут напрямую вызывать функции друг друга. Им требуется способ обмена данными — то есть, необходим _интерфейс взаимодействия_.

Одним из простейших способов организации такого взаимодействия является использование общего файла. Допустим, это текстовый файл `users.txt`.

- **Приложение A** записывает в файл данные новых пользователей.
- **Приложение B** периодически читает этот файл и, на основе его содержимого, отправляет письма соответствующим адресатам.

Одним из примитивных, но наглядных способов организации взаимодействия между приложениями является обмен через файл.

- Приложение `A` записывает пользователей в файл `users.txt`,
- Приложение `B` периодически читает этот файл и, основываясь на его содержимом, отправляет письма пользователям.

Эти два приложения никак напрямую не связаны и ничего не знают о внутреннем устройстве друг друга. Однако они оба умеют работать с одним и тем же ресурсом — файлом users.txt. Это и есть их точка соприкосновения, их интерфейс взаимодействия.

Таким образом, эти два приложения взаимодействуют **опосредованно** — не напрямую, а через внешний ресурс, с которым оба умеют работать. Таким ресурсом выступает файл, а сам механизм взаимодействия — это и есть **простейшая форма API**.

В данном случае API реализован в виде файлового обмена, где:

- Файл `users.txt` выступает в роли канала передачи данных.
- Структура и формат содержимого файла являются частью "контракта", то есть самого API.

Такой API включает в себя следующие ключевые элементы:

- **Определённый формат данных**: значения записаны в формате CSV — разделены запятыми, первая строка содержит заголовки.
- **Строгие соглашения между приложениями**:
  - Каждая строка представляет одного пользователя.
  - Порядок полей должен строго соблюдаться.
  - Значения не должны содержать "сырых" запятых без экранирования.
  - Файл должен иметь определённую кодировку (например, UTF-8).
  - Пустые строки игнорируются или обрабатываются определённым образом.

Несмотря на кажущуюся «кустарность» такого решения, перед нами полноценный интерфейс взаимодействия между программами, пусть и без сетевых запросов или объектов. Такой способ можно назвать низкоуровневым API, в котором «вызов функции» заменён записью строки в файл, а «ответ» — чтением строки из этого файла другим приложением.

Нарушение соглашений приведёт к сбою или недопониманию между программами. Поэтому такие контракты на уровне формата и структуры данных — основа любого API, вне зависимости от его формы.

**Главная идея**: API предоставляет абстракцию. Разработчику не нужно разбираться во всех деталях внутреннего кода или устройства системы – достаточно вызывать функции API по заданным правилам.

## Веб-сервисы и веб-приложения

Теперь, разобравшись с общим понятием API, перейдем к понятию веб-сервисов. Под **веб-сервисом** (_веб-службой_) обычно понимают программный сервис, доступный через веб (как правило, по протоколу HTTP), предназначенный для взаимодействия _программ с программами_, а не напрямую с человеком. Веб-сервис предоставляет программный интерфейс (API) для удаленного доступа к каким-либо функциям или данным.

Чтобы понять разницу, сравним веб-сервис с веб-приложением:

- **Веб-приложение** – это сайт или приложение, с которым работает человек. _Например_, интернет-магазин или соцсеть. У него есть кнопки, формы, страницы — это называется пользовательским интерфейсом (UI).
- **Веб-сервис** – это «невидимая» часть, с которой работает не человек, а другая программа. _Например_, мобильное приложение обращается к веб-сервису, чтобы получить список покупок или отправить данные на сервер [^2].

_Например_, веб-сервис "Продажи" может предоставлять данные о товарах, ценах и заказах. Веб-приложение "Интернет-магазин" использует этот веб-сервис для отображения информации пользователю. Аналогично, веб-сервис "Карты" предоставляет информацию о маршрутах и пробках, которую использует веб-приложение "Такси" для расчёта маршрута и времени в пути.

В некоторых случаях взаимодействие происходит не только между веб-приложением и веб-сервисом, но и между несколькими веб-сервисами. _Например_, веб-сервис "Погода" предоставляет данные о температуре и осадках, а веб-сервис "Туризм" использует эти данные для планирования маршрутов и расчёта времени в пути. Веб-приложение "Туризм" затем отображает эту информацию пользователю. Такое взаимодействие можно представить в виде цепочки: `веб-сервис "Погода" → веб-сервис "Туризм" → веб-приложение "Туризм"`.

Веб-сервис зачастую называют _«бэкэндом без фронтенда»_. Он принимает запросы и возвращает структурированные ответы. Эти ответы не обязательно должны быть HTML страницами (как у обычного сайта) – чаще это данные в формате JSON или XML, пригодные для обработки программой. _Например_, запрос к веб-сервису погоды может вернуть JSON: `{"temp":18.5,"unit":"C"}`, а уже приложение, получившее эти данные, решит, как их показать пользователю.

Веб-сервисы решают задачу интеграции и разделения обязанностей. Основные причины использовать веб-сервисы:

- **Обмен данными между различными системами**. Веб-сервисы позволяют одному приложению получать данные или функциональность от другого. _Например_, приложение может через API получать курсы валют у внешнего сервиса, вместо того чтобы содержать свою базу курсов.
- **Многообразие клиентов**. Отделив серверную часть как веб-сервис, вы можете обслуживать сразу несколько типов клиентов – веб-браузеры, мобильные приложения, программы-партнеры. Все они будут использовать один и тот же сервис через API. _Например_, единственный серверный веб-сервис социальной сети может отдавать данные и веб-версии, и мобильному приложению – в разных формах, но через один API.
- **Разделение фронтенда и бекенда**. Современная тенденция – создавать одностраничные приложения (SPA) или мобильные приложения, которые полностью отделены от сервера. Сервер предоставляет только веб-сервис, а весь интерфейс и логика на клиенте. Это даёт независимость разработки: фронтенд-разработчики и бекенд-разработчики работают автономно через согласованный API.
- **Интеграция с внешними партнерами или публичные API**. Многие компании предоставляют открытые веб-сервисы (публичные API), чтобы сторонние разработчики могли строить новые приложения вокруг их данных и возможностей. _Например_, карты Google (Google Maps API) – это веб-сервис, позволяющий встраивать карты и маршруты в свои приложения.

Но как именно веб-сервисы реализуют взаимодействие? Ответ — с помощью API. Рассмотрим это на примере API из предыдущего раздела: взаимодействие веб-приложения «Интернет-магазин» и веб-сервиса «Управление товарами». В данной схеме веб-приложение отвечает за отображение товаров пользователю, а веб-сервис — за управление товарными данными (добавление, удаление, изменение и т.д. в базе данных).

Пример простой реализации взаимодействия может выглядеть так:

- Веб-приложение "Интернет-магазин" записывает запрос в файл `products.txt`, указывая, какие данные о товаре ему нужны.
- Веб-сервис "Управление товарами" считывает этот файл, извлекает необходимые данные из базы данных и записывает результат обратно в `products.txt`.
- Затем веб-приложение "Интернет-магазин" читает файл `products.txt` и отображает полученную информацию пользователю.

Однако, как уже упоминалось ранее, **такой способ взаимодействия крайне неэффективен**. Во-первых, веб-приложение и веб-сервис могут находиться на разных серверах и не иметь общего доступа к одному файлу. Во-вторых, если веб-приложение работает в браузере (например, написано на JavaScript), оно в принципе не может читать файлы с сервера напрямую, так как браузер не имеет доступа к файловой системе.

> [!NOTE]
> Важно заметить, что _все веб-сервисы являются веб-приложениями, но не все веб-приложения являются веб-сервисами_. Под капотом веб-сервис – это тоже приложение на сервере, просто предназначенное для программного доступа.

Поэтому для взаимодействия между веб-приложениями используются другие виды API, и одним из самых популярных является **REST API**, который будет рассмотрен в следующих разделах.

[^1]: _Что такое API простыми словами_. education.yandex.ru [online resource]. URL: https://education.yandex.ru/journal/chto-takoe-api
[^2]: _Чем различаются веб-сервис, веб-приложение и сайт_. polygant [online resource]. URL: https://polygant.net/ru/blog/chem-otlichayutsya-veb-servis-veb-prilozhenie-i-sajt/
